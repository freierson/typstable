---
output:
  github_document:
    html_preview: true
home:
  sidebar:
    structure: [links, license, community, citation, authors, dev]
citation: true
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# typstable <img src="man/figures/logo.svg" align="right" height="139" alt="" />

<div id="badges">
[![R-CMD-check](https://github.com/freierson/typstable/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/freierson/typstable/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/freierson/typstable/graph/badge.svg)](https://app.codecov.io/gh/freierson/typstable)
</div>

The purpose of typstable /ˈtaɪps.tə.bᵊl/ is to produce publication-ready tables for Quarto documents targeting the Typst format. Typst is a modern, open-source, markup-based typesetting system that provides an alternative to LaTeX for rendering PDF documents. This package allows R users to create Typst tables with elaborate formatting.

## Example

```{r data-prep, echo=FALSE, message=FALSE}
library(typstable)
library(dplyr)
library(scales)

# Columns to style
style_cols <- c("mpg", "qsec", "cyl", "disp", "hp", "wt")

# Prepare data
cars <- mtcars |>
  mutate(
    name = rownames(mtcars),
    brand = gsub(" .*", "", name),
    # Remove brand prefix from name
    name = gsub("^\\w+\\s*", "", name)
  ) |>
  filter(brand %in% c("Mazda", "Merc", "Toyota", "Fiat")) |>
  # Fix "Merc" to "Mercedes"
  mutate(brand = if_else(brand == "Merc", "Mercedes", brand))

# Step 1: Create quantile columns using across
cars <- cars |>
  mutate(across(
    all_of(style_cols),
    ~ percent_rank(.x),
    .names = "quantile_{.col}"
  ))

# Step 2: Apply color scale to quantile columns using across
color_scale <- col_numeric(palette = "Blues", domain = c(0, 1))
cars <- cars |>
  mutate(across(
    starts_with("quantile_"),
    ~ color_scale(.x),
    .names = "bg_{sub('quantile_', '', .col)}"
  ))

# Step 3: Create text color columns (white for top 25% quantile)
cars <- cars |>
  mutate(across(
    starts_with("quantile_"),
    ~ if_else(.x >= 0.75, "white", NA_character_),
    .names = "color_{sub('quantile_', '', .col)}"
  ))
```

```{r example, message=FALSE, eval=FALSE}
# Create table with data-driven styling
tbl <- tt(cars, cols = c(.rownames, all_of(style_cols)), preamble='#set text(font: "Arial")') |>
  tt_header_above(c(" " = 1, "Performance" = 2, "Characteristics" = 4)) |>
  tt_column(-1, color = "color_{col}", fill = "bg_{col}") |>
  tt_pack_rows(index = table(cars$brand)) |>
  tt_column(1, width = "25%")
```

```{r table-build, echo=FALSE, message=FALSE}
# Create table with data-driven styling
tbl <- tt(cars, cols = c(.rownames, all_of(style_cols)), preamble='#set text(font: "Arial")') |>
  tt_header_above(c(" " = 1, "Performance" = 2, "Characteristics" = 4)) |>
  tt_column(c(mpg, qsec, cyl, disp, hp, wt), color = "color_{col}", fill = "bg_{col}") |>
  tt_pack_rows(index = table(cars$brand)) |>
  tt_column(1, width = "25%")
```

```{r output, echo=FALSE, results="asis", out.width="100%"}
tt_save(tbl, "man/figures/readme-example.svg", width = "6.5in")
knitr::include_graphics("man/figures/readme-example.svg")
```

