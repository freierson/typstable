---
title: "Introduction to typstable"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to typstable}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
library(typstable)

# Check if Typst is available for rendering examples
has_typst <- tt_typst_available()

# Standard width for rendered tables (matches typical content width)
table_width <- "6.5in"

# Counter for unique figure names
fig_counter <- 0

if(!dir.exists('figures')) {dir.create('figures')}

# Helper to render a table as SVG
render_table <- function(tbl) {
  if (has_typst) {
    fig_counter <<- fig_counter + 1
    f <- file.path("figures", paste0("table-", fig_counter, ".svg"))
    tt_save(tbl, f, width = table_width)
    knitr::include_graphics(f)
  } else {
    cat("*Typst CLI not available - install from https://typst.app/ to see rendered output.*\n")
  }
}
```

## Introduction

The purpose of typstable is to produce publication ready tables
for Quarto documents targeting the Typst format. Typst is a modern, open-source,
markup-based typesetting system that provides an alternative to LaTeX for
rendering PDF documents. In this article I show how to use the typstable package.

## Getting Started

Create a basic table with `tt()`.

```{r}
library(typstable)
sans_font <- '#set text(font: "Arial")'
tbl <- tt(mtcars[1:5, 1:3], preamble = sans_font)
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Apply formatting to cells, rows, and columns

Format specific parts of the table with `tt_column()`, `tt_row()`, and `tt_cell()`. Columns can be targeted using tidyselect syntax. 

```{r}
tbl <- tt(mtcars[1:5, 1:3], preamble = sans_font) |>
  tt_column(2:4, align = "center") |>
  tt_row(3, fill = "yellow") |>
  tt_cell(2, 2, bold = TRUE, rotate = 45, fill = "lightgrey")
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Table Styling

Use `tt_style()` to customize the table appearance.

```{r}
tbl <- tt(mtcars[1:5, 1:3],
          col_names = c("", "Miles/Gallon", "Cylinders", "Displacement"),
          preamble = sans_font) |>
  tt_style(
    striped = TRUE,
    inset = "4pt"
  )
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Column Widths

Control column widths with `tt_widths()`.

```{r}
tbl <- tt(mtcars[1:5, 1:3], preamble = sans_font) |>
  tt_style(stroke = TRUE)

```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Spanning Headers

Add spanning headers with `tt_header_above()`:

```{r}
tbl <- tt(mtcars[1:6, c("mpg", "qsec", "cyl", "disp", "hp", "wt")], preamble = sans_font) |>
  tt_header_above(c(" " = 1, "Performance" = 2, "Characteristics" = 4), gap='5pt') |>
  tt_column(1, width = "25%")
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Row Grouping

Group rows with `tt_pack_rows()`. Sort the data by a grouping variable, then
use `table()` to compute group sizes for the `index` parameter.

```{r}
cars <- mtcars[order(mtcars$cyl), c("mpg", "disp", "hp", "wt", "cyl")]
cars <- do.call(dplyr::bind_rows, lapply(split(cars, cars$cyl), head, 3))
groups <- table(cars$cyl)
groups <- setNames(as.integer(groups), paste(names(groups), "Cylinders"))
tbl <- tt(cars, cols = c(.rownames, mpg, disp, hp, wt), preamble = sans_font) |>
  tt_pack_rows(index = groups) |>
  tt_column(1, width = "30%")
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Saving Tables

If you have the Typst CLI installed, you can export tables to various formats using `tt_save()`.

```{r eval = FALSE}
# Save as SVG
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.svg")

# Save as PNG with higher resolution
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.png", ppi = 300)

# Save as PDF
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.pdf")

# Save Typst source (no CLI required)
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.typ")
```

