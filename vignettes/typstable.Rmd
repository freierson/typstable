---
title: "Introduction to typstable"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to typstable}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
citation: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
library(typstable)

# Check if Typst is available for rendering examples
has_typst <- tt_typst_available()

# Standard width for rendered tables (matches typical content width)
table_width <- "6.5in"

# Counter for unique figure names
fig_counter <- 0

if(!dir.exists('figures')) {dir.create('figures')}
# Helper to render a table as SVG
render_table <- function(tbl) {
  if (has_typst) {
    fig_counter <<- fig_counter + 1
    f <- file.path("figures", paste0("table-", fig_counter, ".svg"))
    tt_save(tbl, f, width = table_width)
    knitr::include_graphics(f)
  } else {
    cat("*Typst CLI not available - install from https://typst.app/ to see rendered output.*\n")
  }
}
```

## Introduction

The purpose of typstable is to produce publication-ready tables
for Quarto documents targeting the Typst format. Typst is a modern, open-source,
markup-based typesetting system that provides an alternative to LaTeX for
rendering PDF documents. In this article I show how to use the typstable package.

## Installation

```{r eval = FALSE}
# Install from GitHub
pak::pak("freierson/typstable")
```

## Getting Started

Create a basic table with `tt()`:

```{r}
library(typstable)
tbl <- tt(mtcars[1:5, 1:3])
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Example

```{r}
tbl <- tbl |>
  tt_row(row = 0, rotate = -45, align = 'left + bottom')
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Table Styling

Use `tt_style()` to customize the table appearance:

```{r}
tbl <- tt(mtcars[1:5, 1:3],
          col_names = c("", "Miles/Gallon", "Cylinders", "Displacement")) |>
  tt_style(
    striped = TRUE,
    header_separate = TRUE,
    inset = "8pt"
  )
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Column, Row, and Cell Formatting

Format specific parts of the table with `tt_column()`, `tt_row()`, and `tt_cell()`:

```{r}
tbl <- tt(mtcars[1:5, 1:3]) |>
  tt_column(mpg, align = "right") |>
  tt_row(1, bold = TRUE) |>
  tt_cell(2, 2, background = "yellow")
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Column Widths

Control column widths with `tt_widths()`. Values are proportional:

```{r}
tbl <- tt(mtcars[1:5, 1:3]) |>
  tt_style(stroke = TRUE) |>
  tt_widths(1, 2, 1, 1)  # 20%, 40%, 20%, 20%
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Spanning Headers

Add spanning headers with `tt_header_above()`:

```{r}
tbl <- tt(mtcars[1:6, c("mpg", "qsec", "cyl", "disp", "hp", "wt")]) |>
  tt_style(header_separate = TRUE) |>
  tt_header_above(c(" " = 1, "Performance" = 2, "Characteristics" = 4), gap='5pt') |>
  tt_column(1, width = "25%")
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Row Grouping

Group rows with `tt_pack_rows()`:

```{r}
tbl <- tt(mtcars[1:6, 1:5]) |>
  tt_pack_rows("4 Cylinders", 1, 2) |>
  tt_pack_rows("6 Cylinders", 3, 6) |>
  tt_column(1, width="30%")
tbl
```

```{r echo = FALSE, results = "asis"}
render_table(tbl)
```

## Saving Tables

If you have the Typst CLI installed, you can export tables to various formats using `tt_save()`.

```{r eval = FALSE}
# Save as SVG
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.svg")

# Save as PNG with higher resolution
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.png", ppi = 300)

# Save as PDF
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.pdf")

# Save Typst source (no CLI required)
tt(mtcars[1:5, 1:3]) |>
  tt_save("table.typ")
```

